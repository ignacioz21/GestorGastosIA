<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrapp links -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Custom links -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    {% block CSS %}
    {% endblock %}
    <title>{% block title %}GestorIA{% endblock %}</title>
</head>
<body class="container">
    <div class="logo-slide">
        <h1 class="logo">BOTGET</h1>
        <div id="final-section">
            <i class="bi bi-person-circle"></i>
            <i class="bi bi-gear-fill"></i>
        </div>
    </div>
    <div class="main-block">
        <header class="full-header">
            <div id="top-section">
                <a class="openModalBtn" id="btn-header" href="">
                    <i class="bi bi-house-fill"></i>    
                    <span id="title_header">Home</span>
                </a>
                <!-- FIXED: Changed to button with proper ID -->
                <a id="btn-header" name="openModalBtn" href="#" onclick="return false;">
                    <i class="bi bi-cash"></i>
                    <span id="title_header">A√±adir</span>
                </a>
                <a id="btn-header" href="">
                    <i class="bi bi-cash-stack"></i>
                    <span id="title_header">Gastos</span>
                </a>
                <a id="btn-header" href="">
                    <i class="bi bi-bar-chart-line"></i>
                    <span id="title_header">Estudio</span>
                </a>
            </div>
        </header> 
        <main class="content">
            {% block content %}
            {% endblock %}
            <form action="/" method="POST">  
                <div id="popupOverlay" class="add-expense-popup">
                    <div class="popup-content">
                        <!-- Header mejorado -->
                        <div class="popup-header">
                            <h2 class="popup-title">
                                <i class="bi bi-wallet2"></i>
                                Nuevo Gasto
                            </h2>
                            <p class="popup-subtitle">Registra tu transacci√≥n de forma r√°pida y sencilla</p>
                            <button id="closePopup" class="btn-close" type="button" aria-label="Close">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>

                        <!-- Tab Navigation mejorado (manteniendo funcionalidad existente) -->
                        <div class="pop-up-options">
                            <a id="btn-option-selected" name="openModalBtn" href="#" onclick="return false;">
                                <i class="bi bi-pencil-square"></i> Manual
                            </a>
                            <a id="btn-option" name="scan-bill" href="#" onclick="return false;">
                                <i class="bi bi-camera"></i> Escanear
                            </a>
                            <a id="btn-option" name="go-ia" href="#" onclick="return false;">
                                <i class="bi bi-robot"></i> IA
                            </a>
                        </div>

                        <!-- Form mejorado manteniendo toda la funcionalidad existente -->
                        <form action="/" method="POST" class="popup-form">
                            <input type="hidden" name="form_type" value="manual">
                            
                            <!-- Amount Section moderna -->
                            <div class="amount-section-modern">
                                <div class="amount-label-modern">
                                    <i class="bi bi-cash-coin"></i>
                                    Cantidad
                                </div>
                                <div style="display: flex; align-items: center; justify-content: center;">
                                    <input type="number" 
                                           placeholder="0.00" 
                                           name="expense-value" 
                                           step="0.01" 
                                           id="expense-box"
                                           class="amount-input-modern"
                                           required>
                                    <span class="currency-modern">$</span>
                                </div>
                            </div>

                            <!-- Panel mejorado -->
                            <div class="panel">
                                <div class="first-section">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">
                                            <i class="bi bi-tag"></i>
                                            Nombre del Gasto
                                        </label>
                                        <input type="text" 
                                               placeholder="Ej: Almuerzo, Gasolina..." 
                                               name="expense-name" 
                                               id="expense-box"
                                               required>
                                    </div>
                                    
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">
                                            <i class="bi bi-arrow-up-down"></i>
                                            Tipo de Transacci√≥n
                                        </label>
                                        <select class="selectpicker form-select" data-width="100%" name="transaction" required>
                                            <option value="">Seleccionar...</option>
                                            {% for t in transaction %}
                                                {% if t == "Income" %}
                                                    <option value="{{ t }}">üí∞ {{ t }}</option>
                                                {% elif t == "Expense" %}
                                                    <option value="{{ t }}">üí∏ {{ t }}</option>
                                                {% else %}
                                                    <option value="{{ t }}">üê∑ {{ t }}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="second-panel">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">
                                            <i class="bi bi-grid-3x3-gap"></i>
                                            Categor√≠a
                                        </label>
                                        <select name="expense-category" 
                                                id="expense-category-select" 
                                                class="expense-category"
                                                onchange="toggleNewCategory()"
                                                required>
                                            <option value="">Seleccionar categor√≠a...</option>
                                            {%  for c in categories  %}
                                                <option value="{{ c['ID'] }}">{{ c['NAME'] }}</option>
                                            {% endfor %}
                                            <option value="new-category">‚ûï A√±adir Nueva Categor√≠a</option>
                                        </select>
                                        <input type="text" 
                                               id="newCategoryInput" 
                                               name="expense-category-new"
                                               placeholder="Nombre de la nueva categor√≠a">
                                    </div>
                                    
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">
                                            <i class="bi bi-calendar3"></i>
                                            Fecha
                                        </label>
                                        <input type="date" 
                                               name="expense-date" 
                                               class="expense-date"
                                               required> 
                                    </div>
                                </div>       
                            </div>
                            
                            <button type="submit" name="btn_manual">
                                <i class="bi bi-check-circle"></i>
                                Registrar Gasto
                            </button>
                        </form>
                    </div>
                </div>
            </form>
            <!-- Bill scan pop up -->
            <!--
            <div id="popupOverlayBillScan" class="scan-bill-popup">
                <div class="popup-content-scan">
                    <button id="closePopupBillScan" class="btn-close" aria-label="Close">
                        <i class="bi bi-x-square-fill"></i>
                    </button>
                    <div class="pop-up-options">
                        <a id="btn-option"  name="openModalBtn" href="#" onclick="return false;">Manual</a>
                        <a id="btn-option-selected" name="scan-bill" href="#" onclick="return false;">Escanear factura</a>
                        <a id="btn-option" name="go-ia" href="#" onclick="return false;">Clasificador IA</a>
                    </div>

                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">
                            <i class="bi bi-cloud-arrow-down"></i>
                        </div>
                        <div class="upload-text">Upload your file</div>
                        <input type="file" id="fileInput" class="hidden-file-input" accept=".pdf,.png,.jpg,.jpeg">
                    </div>
                    <div class="amount-section">
                        <div class="amount-label">Amount</div>
                        <div class="amount-value">0.00 $</div>
                    </div>

                    <form class="expense-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Expense</label>
                                <input type="text" class="form-input" placeholder="Expense name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <input type="text" class="form-input" placeholder="Description">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <input type="text" class="form-input" placeholder="Category">
                            </div>
                        </div>

                        <button type="submit" class="submit-btn" name="btn_scan">
                            Submit
                        </button>
                    </form>
                </div>
            </div>
            -->
            <form action="/" method="POST" enctype="multipart/form-data">
                <!-- IA Interpreter -->
                <div class="ia-popup" id="popupOverlayIA">
                    <div class="ia-popup-container">
                        <!-- FIXED: Changed ID to be unique -->
                        <button id="closePopupIA" class="btn-close" aria-label="Close">
                            <i class="bi bi-x-square-fill"></i>
                        </button>
                        <div class="pop-up-options">
                            <a id="btn-option" name="openModalBtn" href="#" onclick="return false;">Manual</a>
                            <a id="btn-option" href="#" name="scan-bill"  onclick="return false;">Escanear factura</a>
                            <a id="btn-option-selected" name="go-ia" href="#" onclick="return false;">Clasificador IA</a>
                        </div>
                        <form action="/" method="POST" name="ia">
                            <input type="hidden" name="form_type" value="ia">
                            
                            <div class="amount-section-ia">
                                <div class="amount-label-ia">Cantidad</div>
                                <div class="amount-value-ia">
                                    <input type="number" name="ia-amount" class="amount-input-ia" placeholder="0.00" step="0.01" >
                                </div>
                            </div>
                            
                            <div class="form-group-ia">
                                <label class="form-label-ia">What did you do?</label>
                                <textarea name="ia-description" class="form-textarea-ia" placeholder="Describe your expense..." ></textarea>
                            </div>
                            
                            <div class="form-row-ia">
                                <div class="form-group-ia">
                                    <label class="form-label-ia">Date</label>
                                    <input type="date" name="ia-date" class="form-input-ia">
                                </div>
                            </div>
                            
                            <button type="submit" name="btn_ia">Submit</button>
                        </form>
                    </div>
                </div>
            </form>
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/base.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    {% block JS %}
    {% endblock %}
</body>
</html>